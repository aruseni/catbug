/*! catbug.js 0.1.0
 *  2013-05-19 18:08:36 +0400
 *  https://github.com/pozadi/catbug.js
 */
window.catbug=function(){return catbug.core.module.apply(catbug,arguments)},catbug.ns=function(t,e){var n,r,i,l,o;for(n=this,o=t.split("."),i=0,l=o.length;l>i;i++)r=o[i],r&&(n=n[r]||(n[r]={}));return e(n,this)},catbug.ns("treeParser",function(t){return t.attrDelimiter=/\s+/,t.sideQuotes=/^["']|["']$/g,t.nonEmpty=/\S+/,t.indentation=/^\s+/,t.selectorAndAttrs=/^([^\(\)]+)(?:\(([^\(\)]+)\))?$/,t.parseToRaw=function(e){var n,r,i,l,o;return l=function(e){return t.nonEmpty.test(e)},n=function(e){var n;return{level:(null!=(n=t.indentation.exec(e))?n[0].length:void 0)||0,data:$.trim(e)}},o=function(t,e){var n,r,i,l,o;for(null==e&&(e="level"),n=_.min(_.pluck(t,"level")),o=[],i=0,l=t.length;l>i;i++)r=t[i],o.push(r[e]=r.level-n);return o},r=function(t,e){var n,i,l,u,s,a,c;for(o(t,"normLevel"),s=[],i=null,n=function(){var t;return i?(t={data:i.data,level:i.level,parent:e},t.children=r(u,t),s.push(t)):void 0},a=0,c=t.length;c>a;a++)if(l=t[a],l.normLevel>0){if(!i)throw Error("unexpected indent");u.push(l)}else n(),i=l,u=[];return n(),s},i=_.chain(e.split("\n")).filter(l).map(n).value(),o(i),r(i,null)},t.flat=function(t){var e,n;return n=[],e=function(t){var r,i,l,o;for(o=[],i=0,l=t.length;l>i;i++)r=t[i],n.push(r),o.push(e(r.children));return o},e(t),n},t.parseAttributes=function(e){var n,r,i,l,o,u,s,a;if(i={},e)for(s=e.split(t.attrDelimiter),o=0,u=s.length;u>o;o++)n=s[o],a=n.split("="),r=a[0],l=a[1],i[r]=null!=l?l.replace(t.sideQuotes,""):void 0;return i},t.parseLine=function(e){var n;if(n=t.selectorAndAttrs.exec(e),!n)throw Error("wrong syntax");return{selector:$.trim(n[1]),attributes:t.parseAttributes(n[2])}},t.selectorToName=function(t){return $.camelCase(t.replace(/[^a-z0-9]+/gi,"-").replace(/^-/,"").replace(/-$/,"").replace(/^js-/,""))},t.genName=function(e){return e.name=e.attributes.name?e.attributes.name:t.selectorToName(e.selector)},t.parse=function(e){var n,r,i,l,o,u;if(i=t.parseToRaw(e),1!==i.length)throw Error("more than one root");for(r=t.flat(i),l=0,o=r.length;o>l;l++)n=r[l],_.extend(n,t.parseLine(n.data)),n.selector=n.selector.replace("&",null!=(u=n.parent)?u.selector:void 0);return r=_.map(r,function(t){return _.pick(t,"selector","attributes","level")}),_.each(r,t.genName),{root:_.findWhere(r,{level:0}),elements:_.filter(r,function(t){return t.level>0})}}}),catbug.ns("core",function(t){return jQuery.prototype.catbug=function(e){var n;return n=this.get(0),n?t.instances[e].init(n):void 0}});var __bind=function(t,e){return function(){return t.apply(e,arguments)}};catbug.ns("core",function(t,e){return t.instances={},t.elementMixin={update:function(){var t,e,n,r;for(this.splice(0,this.length),r=$(this.selector,this.context),e=0,n=r.length;n>e;e++)t=r[e],this.push(t);return this},byChild:function(t){return $(t).parents(this.selector)},byParent:function(t){return t.jquery&&(t=t.get(0)),this.filter(function(){return $.contains(t,this)})}},t.builderContextMixin={update:function(t){var e,n,r,i,l,o,u,s,a,c;if(t){for(u=t.split(" "),a=[],r=0,l=u.length;l>r;r++)n=u[r],a.push(this[n].update());return a}for(s=this.__elements,c=[],i=0,o=s.length;o>i;i++)e=s[i],c.push(this[e.name].update());return c}},t.Module=function(){function e(t,e,n,r){this.name=t,this.rootSelector=e,this.elements=n,this.builder=r,this.initAll=__bind(this.initAll,this)}return e.prototype.buildElement=function(e,n){return _.extend($(e,n),t.elementMixin)},e.prototype.buildElements=function(t){var e,n,r,i,l;for(n={},l=this.elements,r=0,i=l.length;i>r;r++)e=l[r],n[e.name]=this.buildElement(e.selector,t);return n},e.prototype.builderContext=function(e){var n,r,i,l,o;for(r={},o=["find","on","off","data","addClass","removeClass","toggleClass","hide","show","toggle"],i=0,l=o.length;l>i;i++)n=o[i],r[n]=_.bind(e[n],e);return _.extend(r,{root:e,__elements:this.elements},t.builderContextMixin,this.buildElements(e))},e.prototype.init=function(t){var e;return t=$(t),e="catbug-"+this.name,t.data(e)||t.data(e,this.builder.call(this.builderContext(t))),t.data(e)},e.prototype.initAll=function(){var t,e,n,r,i;for(r=$(this.rootSelector),i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(this.init(t));return i},e}(),t.module=function(n,r,i){var l;return null==i&&(i=r,r=_.uniqueId("lambda-")),n=e.treeParser.parse(n),t.instances[r]=l=new t.Module(r,n.root.selector,n.elements,i),$(l.initAll)}});